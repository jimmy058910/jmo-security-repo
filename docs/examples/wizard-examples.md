# Interactive Wizard Examples

The JMo Security Wizard provides a guided, interactive experience for beginners to perform security scans without needing to know command-line flags.

## Table of Contents

- [Basic Interactive Mode](#basic-interactive-mode)
- [Non-Interactive Mode](#non-interactive-mode)
- [Docker Mode](#docker-mode)
- [Artifact Generation](#artifact-generation)
- [Common Workflows](#common-workflows)

---

## Basic Interactive Mode

The wizard guides you through six steps to configure and run a security scan.

### Starting the Wizard

```bash
jmotools wizard
```

### Interactive Steps

#### Step 1: Select Scanning Profile

Choose from three profiles based on your needs:

- **fast** (2-5 minutes): Quick scan with core tools (gitleaks, semgrep)
- **balanced** (5-15 minutes): Comprehensive scan with all recommended tools
- **deep** (15-45 minutes): Exhaustive scan with all tools

#### Step 2: Select Execution Mode

Choose how to run the scan:

- **native**: Use locally installed security tools
- **docker**: Use pre-built Docker image (zero installation required)

The wizard automatically detects if Docker is installed and running.

#### Step 3: Select Scan Target

Choose what to scan:

- **repo**: Single repository
- **repos-dir**: Directory containing multiple repos
- **targets**: File listing repo paths
- **tsv**: Clone repos from TSV file

For `repos-dir`, the wizard shows detected repositories and their count.

#### Step 4: Advanced Configuration

Optionally customize:

- **Threads**: Parallelism level (default based on profile)
- **Timeout**: Per-tool timeout in seconds
- **Fail-on**: Severity threshold for CI/CD (CRITICAL, HIGH, MEDIUM)

#### Step 5: Review Configuration

Review your choices and confirm before execution.

#### Step 6: Execute Scan

The wizard generates and displays the command, then prompts for execution.

---

## Non-Interactive Mode

Use defaults for automated workflows or scripting.

### Quick Scan with Defaults

```bash
# Use balanced profile on current directory
jmotools wizard --yes
```

### With Custom Options

```bash
# Fast profile in Docker mode
jmotools wizard --yes --docker

# Specific directory
cd /path/to/repos
jmotools wizard --yes
```

**Note:** Non-interactive mode uses these defaults:

- Profile: balanced
- Target: current directory (repos-dir mode)
- Docker: enabled if available and running
- Results: `./results`

---

## Docker Mode

The wizard can use Docker to avoid installing 10+ security tools locally.

### Interactive Docker Mode

```bash
jmotools wizard
```

At Step 2, choose **docker** mode. The wizard will use `ghcr.io/jimmy058910/jmo-security:latest`.

### Force Docker Mode

```bash
jmotools wizard --docker
```

This skips the execution mode prompt and uses Docker directly (if available).

### Docker Mode Benefits

- Zero tool installation
- Consistent tool versions
- Portable across systems
- Immediate scanning capability

---

## Artifact Generation

Generate reusable artifacts without running a scan.

### Generate Makefile Target

```bash
jmotools wizard --emit-make-target Makefile.security
```

**Output:**
```makefile
# JMo Security Scan Target (generated by wizard)
.PHONY: security-scan
security-scan:
	jmotools balanced --repos-dir /home/user/repos --results-dir results --threads 4 --timeout 600 --human-logs
```

**Usage:**
```bash
make -f Makefile.security security-scan
```

### Generate Shell Script

```bash
jmotools wizard --emit-script scan.sh
```

**Output:**
```bash
#!/usr/bin/env bash
# JMo Security Scan Script (generated by wizard)
set -euo pipefail

jmotools balanced --repos-dir /home/user/repos --results-dir results --threads 4 --timeout 600 --human-logs
```

**Usage:**
```bash
chmod +x scan.sh
./scan.sh
```

### Generate GitHub Actions Workflow

#### Native Mode

```bash
jmotools wizard --emit-gha .github/workflows/security.yml
```

**Output:**
```yaml
name: Security Scan
on:
  push:
    branches: [main]
  pull_request:
  schedule:

    - cron: '0 0 * * 0'  # Weekly

jobs:
  security-scan:
    runs-on: ubuntu-latest
    steps:

      - uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'

      - name: Install JMo Security
        run: pip install jmo-security

      - name: Install Security Tools
        run: |
          # Install based on profile: balanced
          # Tools: gitleaks, noseyparker, semgrep, syft, trivy, checkov, hadolint
          # See: https://github.com/jimmy058910/jmo-security-repo#tool-installation

      - name: Run Security Scan
        run: |
          jmotools balanced --repos-dir . --results-dir results \
            --threads 4 \
            --timeout 600

      - name: Upload Results
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: security-results
          path: results/

      - name: Upload SARIF
        if: always()
        uses: github/codeql-action/upload-sarif@v3
        with:
          sarif_file: results/summaries/findings.sarif
```

#### Docker Mode

```bash
jmotools wizard --docker --emit-gha .github/workflows/security-docker.yml
```

**Output:**
```yaml
name: Security Scan
on:
  push:
    branches: [main]
  pull_request:
  schedule:

    - cron: '0 0 * * 0'  # Weekly

jobs:
  security-scan:
    runs-on: ubuntu-latest
    container:
      image: ghcr.io/jimmy058910/jmo-security:latest
    steps:

      - uses: actions/checkout@v4

      - name: Run Security Scan
        run: |
          jmo scan --repo . --results results --profile balanced \
            --threads 4 \
            --timeout 600

      - name: Upload Results
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: security-results
          path: results/

      - name: Upload SARIF
        if: always()
        uses: github/codeql-action/upload-sarif@v3
        with:
          sarif_file: results/summaries/findings.sarif
```

---

## Common Workflows

### First-Time User (No Tools Installed)

```bash
# Use Docker mode to avoid tool installation
jmotools wizard --docker
```

**Steps:**

1. Choose **balanced** profile (default)
2. Docker mode detected and enabled
3. Enter repos directory path
4. Accept defaults for threads/timeout
5. Review and confirm
6. Execute scan

### CI/CD Integration Setup

```bash
# Generate GitHub Actions workflow with HIGH threshold
jmotools wizard --emit-gha .github/workflows/security.yml
```

Then edit the generated workflow to add `--fail-on HIGH`:

```yaml

- name: Run Security Scan
  run: |
    jmotools balanced --repos-dir . --results-dir results \
      --threads 4 \
      --timeout 600 \
      --fail-on HIGH
```

### Weekly Scheduled Scans

1. Generate a shell script:

```bash
jmotools wizard --emit-script ~/weekly-scan.sh
```

2. Add to crontab:

```bash
crontab -e
```

```cron
# Run security scan every Sunday at 2 AM
0 2 * * 0 /home/user/weekly-scan.sh
```

### Multi-Repository Audit

1. Create a directory with repos:

```bash
mkdir ~/security-audit
cd ~/security-audit
git clone https://github.com/org/repo1.git
git clone https://github.com/org/repo2.git
git clone https://github.com/org/repo3.git
```

2. Run wizard:

```bash
jmotools wizard
```

3. Select:
   - Profile: **deep**
   - Mode: **native** or **docker**
   - Target: **repos-dir** → `/home/user/security-audit`
   - Threads: 2 (for deep scans)

### Clone from TSV and Scan

1. Create TSV file (`repos.tsv`):

```tsv
url	description
https://github.com/org/repo1.git	Main API
https://github.com/org/repo2.git	Frontend
https://github.com/org/repo3.git	Mobile app
```

2. Run wizard:

```bash
jmotools wizard
```

3. Select:
   - Profile: **balanced**
   - Mode: **docker** (recommended)
   - Target: **tsv** → `./repos.tsv`
   - Destination: `cloned-repos`

### Quick Validation Before Commit

```bash
# Fast scan on current repo
cd /path/to/my-repo
jmotools wizard --yes
```

Uses defaults:

- Profile: balanced
- Target: current directory
- Results: `./results`

Then check:

```bash
cat results/summaries/SUMMARY.md
open results/summaries/dashboard.html
```

---

## Tips and Tricks

### 1. Save Time with Non-Interactive Mode

If you're repeating scans with similar settings:

```bash
# Save the generated command from first run
jmotools wizard --yes 2>&1 | grep "jmotools balanced"

# Run directly next time
jmotools balanced --repos-dir ~/repos --results-dir results --threads 4 --timeout 600
```

### 2. Docker Mode for Clean Environments

Use Docker mode for:

- CI/CD pipelines (consistent environment)
- Testing new tool versions
- Avoiding local tool installation
- Running on different machines

### 3. Generate Artifacts for Team

Share generated artifacts with your team:

```bash
# Generate Makefile for team
jmotools wizard --emit-make-target Makefile.security
git add Makefile.security
git commit -m "Add security scan Makefile target"
```

Team members can then run:

```bash
make -f Makefile.security security-scan
```

### 4. Profile Selection Guide

- **fast**: Pre-commit hooks, quick validation (2-5 min)
- **balanced**: CI/CD pipelines, regular audits (5-15 min)
- **deep**: Weekly/monthly deep audits, compliance (15-45 min)

### 5. Severity Threshold for CI

Set `--fail-on` based on your security posture:

- `CRITICAL`: Only block on verified secrets
- `HIGH`: Block on likely secrets and serious vulnerabilities
- `MEDIUM`: Stricter gating for sensitive projects
- _(empty)_: Don't fail, just report (for monitoring)

---

## Troubleshooting

### Docker Not Found

If wizard shows "Docker not detected":

```bash
# Install Docker first
# See: https://docs.docker.com/get-docker/

# Verify installation
docker --version
docker info
```

### No Repositories Detected

If wizard warns "No git repositories detected" in repos-dir mode:

**Check:**

1. Path points to directory containing repos (not a single repo)
2. Each subdirectory has a `.git` folder

**Example correct structure:**

```text
~/my-repos/
├── repo1/
│   └── .git/
├── repo2/
│   └── .git/
└── repo3/
    └── .git/
```

### Wizard Cancelled

Press `Ctrl+C` at any time to cancel. The wizard is stateless and can be rerun.

---

## See Also

- [QUICKSTART.md](../../QUICKSTART.md) - Quick start guide
- [README.md](../../README.md) - Comprehensive documentation
- [DOCKER_README.md](../DOCKER_README.md) - Docker usage guide
- [github-actions-docker.yml](./github-actions-docker.yml) - GHA examples
